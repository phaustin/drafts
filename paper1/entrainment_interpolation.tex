%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PREAMBLE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% The following two commands will generate a PDF that follows all the 
% requirements for submission and peer review.  Uncomment these commands to 
% generate this output (and comment out the two lines below.)
%
% DOUBLE SPACE VERSION FOR SUBMISSION TO THE AMS
\documentclass[12pt]{article}
\usepackage{ametsoc}
%
% The following two commands will generate a single space, double column paper 
% that closely matches an AMS journal page.  Uncomment these commands to 
% generate this output (and comment out the two lines above. FOR AUTHOR USE 
% ONLY. PAPERS SUBMITTED IN THIS FORMAT WILL BE RETURNED TO THE AUTHOR for 
% submission with the correct formatting.
%
% TWO COLUMN JOURNAL PAGE LAYOUT FOR AUTHOR USE ONLY
%%%%\documentclass[10pt]{article}
%%%%\usepackage{ametsoc2col}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ABSTRACT
%
% Enter your Abstract here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\myabstract}{
Direct calculations of the entrainment and detrainment of air into and out of
clouds require a knowledge of the relative velocity difference between the air 
and the cloud surface.  However, the discrete numerical model grids force the 
distance moved by a cloud surface over a time step to be either zero or the 
width of a model grid cell.  Here we present a method for the subgrid 
interpolation of a cloud surface on a discrete numerical model grid.  This
method is used to calculate entrainment and detrainment rates for an LES model,
which are compared with rates calculated via the direct flux method of 
\cite{Romps2010}.  The comparison suggests our method has small biases in 
entrainment and detrainment values, but is capable of much finer temporal 
resolution, making it suitable for entrainment and detrainment calculations of 
individual clouds.
}
%
\begin{document}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TITLE
%
% Enter your TITLE here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{\textbf{\large{Interpolation of LES cloud surfaces for use in direct
calculations of entrainment and detrainment}}}
%
% Author names, with corresponding author information. 
% [Update and move the \thanks{...} block as appropriate.]
%
\author{\textsc{Jordan T. Dawe}
	\thanks{\textit{Corresponding author address:} 
	Jordan T. Dawe, 
        Department of Earth and Ocean Sciences, 
        University of British Columbia, 
	6339 Stores Road, 
        Vancouver, BC, 
        V6T 1Z4. 
	\newline{E-mail: jdawe@eos.ubc.ca}}\quad\textsc{and Philip Austin}\\
\textit{\footnotesize{Department of Earth and Ocean Sciences, 
                      University of British Columbia, Vancouver, BC}}
}
%
% Formatting done here...Authors should skip over this.  See above for abstract.
\ifthenelse{\boolean{dc}}
{
\twocolumn[
\begin{@twocolumnfalse}
\amstitle

% Start Abstract (Enter your Abstract above.  Do not enter any text here)
\begin{center}
\begin{minipage}{13.0cm}
\begin{abstract}
	\myabstract
	\newline
	\begin{center}
		\rule{38mm}{0.2mm}
	\end{center}
\end{abstract}
\end{minipage}
\end{center}
\end{@twocolumnfalse}
]
}
{
\amstitle
\begin{abstract}
\myabstract
\end{abstract}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MAIN BODY OF PAPER
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

**TK** Add stuff about other entrainment problems

The largest uncertainties in climate sensitivity estimates from Global 
Circulation Model (GCM) simulations come from the subgridscale parameterization 
of low clouds \citep{Colman2003,Bony2005,Webb2006}.  Specifically, 
stratocumulus clouds and the transition regime from stratocumulus to trade 
cumulus are the dominant source of variance between models in the estimation of 
the cloud radiative response to changing climate \citep{Williams2009}.

Proper simulation of the subgridscale effect of cumulus clouds in GCMs requires 
understanding the rates at which air is entrained into and detrained from the 
clouds. Cloud entrainment and detrainment rates exert influences on profiles of 
cloud properties, the height of the cloud tops, the amount of heat and moisture 
the clouds transport upwards, and the heights at which the clouds deposit that 
heat and moisture.  They also have effects on the vertical transport of 
aerosols out of the boundary layer and the rate at which chemical reactions can 
occur in those aerosols \citep{Barahona2007,Anldrejczuk2008}. A simple 
entraining plume model is at the heart of many parameterizations of shallow and 
deep convection, and a variety of approaches to calculate appropriate 
entrainment and detrainment rates for these models have been proposed
\citep{Lock2000,Bretherton2009,Siebesma2007}.

Large Eddy Simulation (LES) is an important tool used in the study of cloud 
entrainment and detrainment. LES models achieve grid resolutions on the order 
of 10-100 m, well within the domain of the Kolmagorov -5/3 turbulence spectrum. 
This allows for a relatively simple turbulence model that captures the 
important statistics of the subgridscale eddy fluxes and thus, an accurate 
representation of the atmospheric physics of a domain $\approx$ 10 km$^{2}$, 
which is enough to simulate a field of shallow clouds. LES simulations can be 
ground-truthed against results taken from field surveys such as the Barbados 
Oceanographic and Meteorological Experiment \citep[BOMEX;][]{Holland1973} or 
the Atmospheric Radiation Measurement \citep[ARM;][]{Brown2002} Program, and 
such comparisons show good agreement between LES and data.

Several recent studies have looked at the life cycle of individual clouds taken 
from LES models, trying to break the cloud field into its component parts. 
Estimates of entrainment and detrainment rates for individual clouds would be 
quite useful in these types of studies, but are difficult to achieve. 
Entrainment and detrainment rates are typically calculated in LES simulations 
by recording budgets of bulk conserved tracer variables, such as the total 
humidity or the liquid water moist static energy, and inferring the amount of
fluid exchange between cloud and clear air that is needed to explain the rate 
at which that tracer is being vertically advected within the cloud field. These 
budgets typically assume the clouds and the cloud environment are horizontally 
homogeneous slabs; this is a much less accurate assumption on the level of an 
individual cloud.

Alternatively, entrainment and detrainment could simply be calculated directly 
from the LES velocity, pressure, humidity and temperature fields.  
\cite{Siebesma1998} defines Entrainment and Detrainment as
\begin{equation}
E = -\frac{1}{A}\oint_{\mathbf{\hat{n}}\cdot(\mathbf{u} - \mathbf{u_i}) < 0}
\mathbf{\hat{n}}\cdot(\mathbf{u}-\mathbf{u_i})dl
\end{equation}
\begin{equation}
D = \frac{1}{A}\oint_{\mathbf{\hat{n}}\cdot(\mathbf{u} - \mathbf{u_i}) > 0}
\mathbf{\hat{n}}\cdot(\mathbf{u}-\mathbf{u_i})dl
\end{equation}
where $E$ and $D$ are the entrainment and detrainment rates in kg m$^{-3}$ 
s$^{-1}$, $u$ is the velocity of the air in m s$^{-1}$, $u_i$ is the velocity 
of the cloud surface in m s$^{-1}$, A is the area of the cloud in m,
$\mathbf{\hat{n}}$ is a unit vector directed out the cloud surface, and the 
path integral is taken around the cloud surface at a constant vertical level.
However, the accuracy of this method suffers from the need to calculate the 
velocity of the air relative to the cloud surface.  In reality these velocities 
are very nearly identical, \textasciitilde{} 1-2 m s$^{-1}$, but the discrete 
nature of the LES model grid forces the modeled surface velocity to be either 
0 m s$^{-1}$ or $\Delta x / \Delta t \approx$ 15-30 m s$^{-1}$, where 
$\Delta x$ is the model grid spacing and $\Delta t$ is the model time step.  The
surface of the cloud only moves when a grid cell's humidity reaches saturation, 
and when it does, an entire grid cell worth of fluid leaves or enters the cloud.

\cite{Romps2010} very recently overcame this problem by averaging the surface 
fluxes over the time needed for an entire grid cell to entrain or detrain.
However, fine temporal and spatial resolution of entrainment and detrainment 
variability is difficult to achieve with this method due to the long temporal 
averages needed.  Here we present a method for calculation of the cloud 
entrainment and detrainment rates that relies on interpolation of the subgrid 
location of the cloud surface.  We believe this method can be used to produce 
accurate estimates of the cloud entrainment and detrainment rates for 
individual LES clouds.  In section 2 we describe this method, in section 3 we 
describe the model configuration we used to test this method, in section 4 we 
compare this calculation with entrainment and detrainment rates calculated 
using \cite{Romps2010} direct entrainment calculation, in section 5 we 
discuss our results, and in section 6 we present our conclusions.  

%==============================================================================

\section{Method}

Consider a numerical model grid cell containing a cloud surface with normal 
vector $\mathbf{C}$, where $\mathbf{C}$ points outward from the cloud.  This 
surface, combined with $\mathbf{W}$, the portion of the grid cell walls that 
lie within the cloud, encloses a cloud volume $V$ with surface $\mathbf{A}
= \mathbf{C} \cup \mathbf{W}$.  \cite{Siebesma1998} gives the net entrainment 
and detrainment over the cloud surface to be:
\begin{equation}
\label{eq:E_minus_D} 
E - D = \int_C \rho ( \mathbf{u} -  \mathbf{u_i}) \cdot d\mathbf{C},
\end{equation}
where $\rho$ is the air density in kg m$^{-3}$, $\mathbf{u}$ is the velocity
of the air in m s$^{-1}$ and $\mathbf{u_i}$ is the velocity of the cloud 
interface.  Calculating this integral requires knowledge of the velocity field
over the surface of $\mathbf{C}$ and the time evolution of $\mathbf{C}$, 
neither of which is easily calculated in a numerical model.  Instead, we seek a
simplified but equivalent calculation.

To calculate the velocity of the cloud interface, we make use of the Leibnitz 
Theorem:
\begin{equation}
\label{eq:leibnitz} 
\frac{d}{dt}\int_{V(t)} \rho dV = 
  \int_{V(t)} \frac{\partial \rho}{ \partial t} dV 
  + \int_{A(t)} \rho \mathbf{u_i}\cdot d\mathbf{A}.
\end{equation}
Since the walls of the grid cell do not move, $\mathbf{u_i}$ is 0 over 
$\mathbf{W}$.  If we also assume ${\partial \rho}/{ \partial t} \approx 0$, we
get
\begin{equation}
\label{eq:leibnitz2} 
    \rho \frac{d}{dt}\int_{V(t)} dV = 
    \int_{C(t)} \rho \mathbf{u_i}\cdot d\mathbf{C}.
\end{equation}
We then combine equations (\ref{eq:E_minus_D}) and (\ref{eq:leibnitz2}) to give:
\begin{equation}
\label{eq:step1} 
      E - D = \int_C \rho \mathbf{u} \cdot d\mathbf{C} 
            - \rho \frac{d}{dt}\int_{V(t)} dV.
\end{equation}

Next we apply the divergence theorem to simplify the flux integral through 
$\mathbf{C}$:
\begin{equation}
\label{eq:divergence} 
\int_{V} \nabla \cdot (\rho \mathbf{u}) dV = 
  \int_{A} \rho \mathbf{u}\cdot d\mathbf{A}
\end{equation}
Due to mass conservation, $\nabla \cdot (\rho \mathbf{u}) = 0$, which implies
\begin{equation}
\label{eq:divergence3} 
  \int_{C} \rho \mathbf{u}\cdot d\mathbf{C} = 
    - \int_{W} \rho \mathbf{u}\cdot d\mathbf{W}
\end{equation}
since $\mathbf{A}$ is the union of $\mathbf{C}$ and $\mathbf{W}$.  Substituting
this into (\ref{eq:step1}) results in
\begin{equation}
\label{eq:entrainment_detrainment} 
E - D = - \int_W \rho \mathbf{u} \cdot d\mathbf{W} - \rho \frac{dV}{dt}.
\end{equation}
Therefore, we can find the entrainment and detrainment by calculating the mass
flux through the cloudy portion of the grid cell walls and the rate of change
of the cloud volume inside the grid cell.  If equation $E - D$ is greater than 
zero, the total is applied to entrainment and if less than zero, to 
detrainment.  This technique works equally well for flux through any isosurface 
of a scalar quantity defined within the model, though slight modifications must
be made for positive definite quantities.  In this paper we perform these 
calculations for the cloud core, which we define following \cite{Siebesma1995} 
as fluid having condensed liquid water, upward velocity, and positive buoyancy 
relative to the horizontal mean.  

Calculating the mass flux through the grid cell walls can be accomplished using 
the numerical model's advection routine; this is trivial for a model using an 
Arakawa C-grid, while interpolation can give fluxes for other grid 
configurations.  We assume the mass flux is constant over the grid cell wall.  

There are a multitude of interpolation schemes that can be used to determine 
the cloud core volume and cell wall area in a numerical model.  The simplest 
would be to assume that saturated grid cells with positive vertical velocity 
and virtual potential temperature $\theta_v$ (K) greater than the horizontal 
mean are completely filled with cloud core, and otherwise grid cells contain 
no cloud core at all.  We refer to this as the "no interpolation" case.  Since
the cloud core surface only moves when a whole grid cell undergoes 
condensation or evaporation this will result in poor estimates of $dV/dt$ and
$\mathbf{S}$, which will overestimate the entrainment and detrainment.  To 
reduce this overestimate, we interpolate the location of the cloud surface at 
each time step.  Next we describe the interpolation scheme we use for this 
purpose.

%-----------------------------------------------------------------------------

\subsection{Cloud core surface interpolation}

Several standard techniques exist for subgrid isosurface interpolation in the 
field of computer visualization, such as the Marching Cubes algorithm 
\citep{Lorensen1987}.  In the spirit of these techniques, we have implemented 
a scheme that relies on subdividing the grid cells into regular sub-cells, 
finding the location of the cloud surface within these sub-cells, and then 
reassembling the cells to construct the location of the cloud core surface.
Our interpolation method, which we refer to as the "tetrahedral interpolation"
case, splits the cubic grid cell into six pyramids, then splits each pyramid 
into eight tetrahedrons (Figure \ref{fig:tetrahedral_interpolation}, left 
panel).  This results in forty-eight tetrahedrons, each composed of four 
vertices located at the grid cell centre, the center of a grid cell wall, the 
centre of a grid cell edge, and a grid cell corner.

Generally, model scalar quantities will be defined on only one of these 
verticies, and so we must interpolate the surrounding grid to determine the 
quantity values at these points.  On an Arakawa C-grid humidity is defined 
at the grid centers, and so we must interpolate to find the values at three 
of the tetrahedron verticies.  To find values at the center of the grid cell 
wall, we average the two values on opposite sides of the wall; at the grid 
cell edge, we average the four values around the edge; and at the corners, 
we average the values of the eight cells surrounding each corner.

To find the cloud core surface, we must find the location where the total 
humidity equals the saturated humidity, the vertical velocity is zero and 
$\theta_v$ is equal to the horizontal mean of $theta_v$.  First we define a 
variable $q_{diff} = q_t - q_{sat}(T, p)$, where $q_t$ is the total specific 
water and $q_{sat}(T, p)$ is the saturated specific humidity, all in kg 
kg$^{-1}$.  $q_{diff}$ is positive for cloudy points, negative for clear 
points, and zero at the cloud surface, representing the moisture excess or 
deficiency relative to the cloud surface.  Similarily, we calculate $\Delta 
\theta_v = \theta_v - \overline{\theta_v}$, where the bar represents the 
horizontal mean, to represent buoyancy excess or deficiency.  Vertical 
velocity $w$ requires no new variable to be calculated, but as it is defined 
at the center of the top and bottom of the grid cell, the interpolation 
locations are slightly different.

The cloud core surface itself is defined in a similar way to the Marching 
Cubes algorithm \citep{Lorensen1987}.  Each tetrahedron has four vertexes, 
which can either be cloud core or environment, depending on the interpolated 
values of $q_{diff}$, $\Delta \theta_v$, and $w$.  This results in 16 
possible combinations of vertex values that must be considered.  For example,
if the vertexes of a tetrahedron all contain cloud core, the entire 
tetrahedron must contain cloud core, while if three vertexes are core and one 
is environment, the cloud core surface must pass through the tetrahedron.
Many of these cases share symmetries, reducing the number of independent cases 
to four classes.  If the vertexes of a tetrahedron all contain cloud core or 
environment, the surface does not pass through the tetrahedron; this accounts 
for two of the cases.  If only one of the vertexes is clear (or conversely, 
only one is cloudy) than that corner of the tetrahedron is cut by a triangle 
representing the cloud core surface (Figure 
\ref{fig:tetrahedral_interpolation}, center panel); this accounts for eight of
the cases.  The remaining six cases have two vertexes containing cloud core 
and two vertexes containing environment, and result in the tetrahedron being 
cut by two triangles which share a common edge.

The location of the triangles that cut the tetrahedrons are found by 
calculating the fractional distance between connected tetrahedron vertexes at 
which each variable is zero:
\begin{equation}
\label{eq:q_diff_interpolation}
x = \frac{q_{diff}(x_1)}{q_{diff}(x_2) - q_{diff}(x_1)}.
\end{equation}
This calculation is then repeated for $\Delta\theta_v$ and $w$.  The $x$ value 
that returns the smaller cloud core volume is taken to be the location of the 
cloud core surface.   Repeated application of this algoritm to each grid cell 
results in a continuous surface that approximates the subgrid location of the 
cloud core surface (Figure \ref{fig:tetrahedral_interpolation}, right panel).

Once the geometry of the case is determined, the area of the cloudy portion of
the model grid cell wall can be calculated by dividing the cloudy area into 
triangles and summing the triangle areas
\begin{equation}
A = \frac{|(\mathbf{b - c}) \times (\mathbf{a - c})|}{2},
\end{equation}
where $\mathbf{a}$, $\mathbf{b}$, $\mathbf{c}$ are the position vectors of the 
vertices of the triangles.  Similarly, the volume of the cut tetrahedron is 
calculated by subdividing it into smaller tetrahedrons, and summing the volumes 
of the sub-tetrahedrons using
\begin{equation}
V = \frac{|\mathbf{a - d} \cdot ((\mathbf{b - d}) \times (\mathbf{c - d}))|}{6},
\end{equation}
where $\mathbf{a}$, $\mathbf{b}$, $\mathbf{c}$, and $\mathbf{d}$ are the 
position vectors of the vertices of the sub-tetrahedrons.  This results in 
all the information needed to measure entrainment and detrainment via equation
(\ref{eq:entrainment_detrainment}).

%==============================================================================

\section{Model Description}

We have implemented both the tetrahedral surface interpolation scheme and the 
time averaging scheme of \cite{Romps2010}  in the System for Atmospheric 
Modelling \citep[SAM;][]{Khairoutdinov2003}, allowing the model to calculate 
cloud core entrainment and detrainment at every time step.  We have run these 
schemes in a standard GCSS Barbados Oceanographic and Meteorological 
Experiment (BOMEX) LES simulation \citep{Holland1973, Siebesma2003}.  The 
model was run with a domain extent of 6.4 km x 6.4 km in the horizontal and 
3.2 km in the vertical.  Model cloud area, vertical velocity, and cloud core 
entrainment diagnosed from bulk conserved tracer budgets agree well with the 
results presented in \cite{Siebesma2003}.

To examine the resolution dependence of our scheme, we ran three models: one at 
25m grid spacing in all directions with a 1.5 second time step, one at 50m grid 
spacing with a 3 second time step, and one at 100m grid spacing with a 6 second 
time step.  For most of the results we present here we rely on the 25m 
resolution model.  The models were each run for 6 hours, and the first 
three hours of simulation were discarded as the model was still adjusting into 
steady-state.  15 minute averages were output for the terms of each of our 
calculations.  Running the 25m resolution model with the tetrahedral surface 
interpolation scheme resulted in a 26\% model slowdown.  

%==============================================================================

\section{Comparison with the direct flux scheme of Romps}

Next we compare our entrainment and detrainment values calculated directly from 
model fluxes with values calculated from conserved bulk tracer budgets, which 
form the basis of most LES calculations of cloud entrainment and detrainment in 
the literature \citep{Siebesma2003, Rooy2008}.  

%-----------------------------------------------------------------------------

\subsection{Agreement with the continuity equation}

The continuity equation for a turbulent plume, 
\begin{equation}
    \label{eq:continuity}
    \rho \frac{\partial a}{\partial t} 
    + \frac{\partial M_c}{\partial z}
    = E - D
\end{equation},
gives us a check on our calculated values of entrainment and detrainment; to 
satisfy continuity, the difference between the amount of fluid entrained and 
detrained by the clouds at a given height must equal the vertical gradient in 
cloud mass flux plus the rate in change of the cloud area.  We calculate the 
vertical gradient of mass flux in equation (\ref{eq:continuity}) by 
interpolating vertical velocities from the edges to the center of each grid 
cell, then averaging total mass flux within the clouds using these interpolated 
velocities.  Fifteen minute average values of mass flux were output and the 
vertical derivative taken via centered differencing.  Fifteen minute average 
values of $\partial a/\partial t$ are calculated within the model as well.

Comparison of the values of $E-D$ we have calculated with the continuity 
equation shows our direct flux calculations agree with continuity fairly well
(Figure \ref{fig:E_minus_D}), but diverge slightly between cloud base and 1 km
height.  $E-D$ calculated using bulk tracer budgets agrees exactly with the
mass divergence value over the entire column height (not shown).

The small disagreement between the direct flux calculation and the continuity 
equation values of $E-D$ are the result of two differences between the 
calculations.  First, our surface interpolation scheme redefines the volume 
over which the calculation takes place, and so necessarily will give slightly 
different results.  This can be seen in the differences between the $E-D$ 
values calculated from the direct flux without surface interpolation and the 
direct flux with tetrahedral surface interpolation.

Second, we take the disagreement between the continuity equation and $E-D$
calculated via direct fluxes without surface interpolation to be the result of
bias in the continuity equation calculation, as we calculate the direct flux in
the model directly from the tracer advection routine.  The interpolation and
centered differencing we use to calculate mass flux divergence will result in a
slightly different estimate of the mass continuity than one obtains from direct
model fluxes.  Despite these differences, our direct flux calculations 
duplicate the overall shape of the $E-D$ curves calculated from continuity and 
bulk conserved tracer calculations, despite large differences in the actual
magnitudes of $E$ and $D$ in each case.

%-----------------------------------------------------------------------------

\subsection{Correlation of bulk tracer and direct calculation methods}

So far we have shown that our direct flux calculation produces entrainment and
detrainment values that agree reasonably well with the values produced via 
bulk tracer budgets corrected for the presence of the moist cloud shell.  
However, this does not ensure that the same variability is displayed by the two 
calculations.  To analyze the variability, we take the correlation of the 
fifteen-minute averaged $E$ and $D$ values calculated via the two methods over 
the three hour model run at each height to generate correlation profiles.  
Additionally, we calculate correlations between our direct flux scheme and 
the uncorrected bulk tracer method for comparison.  Heights at which the model 
does not have clouds for the entire three hour period are excluded from the 
calculation.  

The result of these calculations shows correlations between the methods for 
both $E$ and $D$ that are significant at the 99\% confidence level over most 
of the cloud layer (Figure \ref{fig:correlations}).  Entrainment near cloud top
and detrainment near cloud base show no correlation, but as this is where the 
bulk tracer method generates negative values of $E$ and $D$, these values are 
physically suspect anyways.  Entrainment shows a minimum in its correlation 
slightly above cloudbase, which we attribute to the negative detrainment values 
corrupting the bulk tracer estimates of entrainment.  At all levels, the 
correction to the bulk tracer calculation increases the correlation with our 
direct flux calculations, primarily in the detrainment. 

Fractional entrainment $\epsilon = E/M_c$ and detrainment $\delta = D/M_c$ show 
little correlation between the direct flux and the bulk tracer method (not 
shown), due to a very high correlation between $E$, $D$ and $M_c$.  This high 
correlation means the timeseries of $E$, $D$ and $M_c$ have nearly identical 
shapes, so dividing $E$ and $D$ by $M_c$ results in nearly constant values. The
small variance that remains in $\epsilon$ and $\delta$ is essentially noise, 
and shows our technique supports the parameterization E = $\epsilon M_c$ and 
D = $\delta M_c$.

%------------------------------------------------------------------------------

\subsection{Statistical robustness}


%------------------------------------------------------------------------------

\subsection{Dependence on model resolution}

\cite{Brown1999} found entrainment and detrainment depended on LES model 
resolution surprisingly little.  Our entrainment and detrainment calculations 
using the bulk tracer method without correcting for the cloud shell show a
similar lack of resolution dependence (Figure \ref{fig:resolution_dependence}).
However, both the direct flux calculation and the bulk tracer calculation 
corrected for the influence of the cloud shell show steadily increasing values 
as grid spacing decreases.  At 100m grid resolution, all three methods produce
similar values.  At 25m and 50m resolution, the direct flux entrainment is 
consistently smaller than the corrected bulk tracer entrainment, while the 
detrainments agree quite well.  These results hold for fractional entrainment 
$\epsilon$ and fraction detrainment $\delta$ values as well (not shown).  

It appears that the constant values for $\epsilon$ and $\delta$ with increasing
model resolution reported by \cite{Brown1999} are the result of compensating
changes in the properties of the cloud shell as the entrainment and detrainment
fluxes increase.  Essentially, as we move to finer grid spacings we resolve
more turbulent recirculations moving fluid in and out of the clouds.  At the
same time, horizontal gradients in bulk properties at the cloud edge are better
resolved, reducing the impact of these greater fluxes on the mean properties of 
clouds and environment.

%==============================================================================

\section{Discussion}

The good agreement between our technique and the bulk tracer method corrected 
for the presence of the cloud shell gives us confidence that our calculation is 
a valid representation of the flux through the cloud surface.  However, as our 
method redefines the location of the cloud volume, there are interpretation 
issues when comparing the fluxes calculated by the two methods.  For example, 
consider a cloud that occupies a single grid cell.  Assume that over the course 
of a model time step, the liquid water content of the cloudy grid cell 
decreases, while advective processes maintain the moisture in the grid cell's 
surroundings constant.  The bulk tracer calculation will interpret this change 
as being the result of entrainment of environmental air drying the fluid in the 
grid cell.  Our surface interpolation, however, will come to the opposite 
conclusion: the reduction of liquid water content will move the interpolated 
cloud surface closer to the grid cell center, reducing the volume of the cloud 
and thus detraining cloud fluid.  We believe effects like this explain why the 
surface interpolation method estimates $E$ and $D$ values that are smaller than 
those estimated via bulk conserved tracers at 100 m resolution; at this grid 
spacing, nearly all the clouds occupy only a single grid cell in the horizontal.
Which calculation is correct depends on which set of assumptions regarding the 
subgridscale variability one prefers.  

At the same time, the entrainment or detrainment value one considers to be 
correct will depend on the purpose for which they are used.  The correction to 
the bulk tracer calculation due to the cloud shell has little bearing on the 
entrainment and detrainment values needed for calculating cloud moisture and 
energy in GCM parameterizations, which only have access to large-scale mean 
bulk tracer values.  However, this correction may be important for calculating 
fluxes of properties that have different radial dependencies than $q_t$ or $h$, 
such as vertical momentum, which is negative in the shell \citep{Heus2008}, or 
for aerosols whose chemical properties are altered by reactions in the presence 
of liquid water \citep{Hoppel1994}.  In any case, the agreement between our 
direct flux method and the bulk tracer method corrected for the influence of 
the cloud shell suggests the shell correction removes a significant bias when 
estimating the total mass exchange between clouds and environment.

Additionally, our scheme shows some benefits over the bulk tracer calculations. 
At cloud base, the bulk tracer calculation show little entrainment occurring, 
instead displaying a large negative entrainment; our scheme displays a large 
entrainment and a large and positive detrainment at cloud base (Figure 
\ref{fig:corrected_entrainment}).  On the other hand, at cloud top the bulk 
tracer method calculates a negative entrainment, while our method calculates a 
small positive value.  In both these cases our calculation generates a more 
physically realistic result.  

\cite{Romps2010} very recently created a complimentary technique to measure 
entrainment and detrainment in an LES, which instead of interpolating the 
location of the cloud surface in space, averages the surface fluxes over the 
time needed for an entire grid cell to entrain or detrain.  Romps' values agree 
quite well with the values we calculate from the bulk conserved tracers 
corrected for the cloud shell, as well at those calculated from our technique 
with tetrahedral interpolation.  Romps' technique has the advantage of making 
no assumptions about the cloud surface and is therefore more consistent with 
the LES model assumptions.  However, our method has the advantage of giving 
instantaneous values for entrainment and detrainment, while Romps' gives 
$\approx$30 second averages.  This makes our technique more useful for tracking 
entrainment variability in individual clouds.

Finally, we note that nothing in our technique is dependent on the shallow 
cumulus cloud regeime, on indeed on clouds at all; it should be equally useful
in calculating entrainment and detrainment through any material surface in a 
numerical model, subject to the caveats we have mentioned.

%==============================================================================

\section{Conclusions}

We have shown that by interpolating the location of cloud surfaces in an LES
model we have been able to calculate entrainment and detrainment rates directly 
from model mass fluxes.  We therefore conclude that this scheme is suitable for 
use in calculating entrainment and detrainment rates for individual clouds in 
an LES model.

%==============================================================================


\begin{acknowledgment}
This paper benefited from helpful discussions with Fleur Couvreux and Catherine 
Rio.  Support was provided by the Canadian Foundation for Climate and 
Atmospheric Science through the Cloud Aerosol Feedback and Climate network.
Figures were generated using the matplotlib library in the Python programming 
language.
\end{acknowledgment}

% Use appendix}[A], {appendix}[B], etc. etc. in place of appendix 
% if you have multiple appendixes.
%\ifthenelse{\boolean{dc}}
%{}
%{\clearpage}
%\begin{appendix}
%\section*{\begin{center}Appendix Title Is Entered Here (Primary heading)\end{center}}
%\subsection{First appendix secondary heading}

%\subsection{Second appendix secondary heading}

%\subsubsection{First appendix tertiary heading}

%\subsubsection{Second appendix tertiary heading}

%\paragraph{First appendix quaternary heading}

%\paragraph{Second appendix quaternary heading}

%\end{appendix}

% Create a bibliography directory and place your .bib file there.
\ifthenelse{\boolean{dc}}
{}
{\clearpage}
\bibliographystyle{./ametsoc}
\bibliography{./bibliography/entrainment_interpolation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FIGURES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}[t]
  \noindent\includegraphics[width=40pc,angle=0]{./figures/tetrahedral_scheme}\\
  \caption{Schematic representation of the tetrahedral interpolation 
scheme.  Left panel shows the subdivision of the model grid cell into forty-
eight tetrahedrons.  Center panel shows the interpolation of the cloud surface
within a sub-tetrahedron between points at the four vertices of the 
tetrahedron.  Right panel shows a horizontal slice through the model's Arakawa 
C-grid.  Rightward pointing triangles represent u-velocity points, upward 
pointing triangles represent v-velocity points, circles represent bulk tracer
quantities, and x represents the location of the cloud surface interpolation
points.  Dotted lines show the boundaries of the tetrahedral subdivision of the 
grid, and grey shading represents cloud volume.}\label{fig:tetrahedral_scheme}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=40pc,angle=0]{./figures/direct_vs_romps}\\
  \caption{Comparison of mean model profiles of core a) entrainment and b) 
detrainment calculated using bulk tracer calculations (grey line), direct flux
calculations using pyramidal interpolation (thin black line), and direct flux
calculations using tetrahedral interpolation (thick black line).  c) Ratio of 
bulk tracer rates to direct flux using tetrahedral interpolation rates of
entrainment (black) and detrainment (grey).  d) and e) are the same as 
a) and b) but for the fractional entrainment and detrainment rates.}
\label{fig:direct_vs_tracer}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=19pc,angle=0]{./figures/E_minus_D}\\
  \caption{Average profiles of entrainment minus detrainment calculated using 
direct fluxes with tetrahedral surface interpolation (dashed line), direct 
fluxes with no surface interpolation (dotted line), bulk tracer calculations 
(black line), and the continuity equation (grey line).}\label{fig:E_minus_D}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=19pc,angle=0]{./figures/correlations}\\
  \caption{Profiles of the correlation between direct entrainment calculations
with tetrahedral surface interpolation and either uncorrected (grey lines) or 
corrected (black lines) bulk tracer calculations for a) entrainment and b) 
detrainment.  Dotted line shows the 99\% confidence level for a significant 
correlation.}\label{fig:correlations}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=19pc,angle=0]{./figures/averaging_convergence}\\ 
  \caption{Time variability of mean entrainment fields for a) tetrahedral 
  interpolation and b) direct entrainment from \cite{Romps2010}.
  }\label{fig:averaging_convergence}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=39pc,angle=0]{./figures/spatial_variability_1min}\\ 
  \caption{Vertical cross-section of a cloud showing one minute averaged 
  Entrainment (a, c) and Detrainment (b, d) fields calculated using our 
  tetrahedral interpoation method (a, b) and Romps's time averaging method 
  (c, d).
  }\label{fig:spatial_variability}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=40pc,angle=0]{./figures/resolution_dependence}\\
  \caption{Mean entrainment (top row) and detrainment (bottom row) calculated
at 25m (left column), 50m (center column), and 100m (right column) grid 
spacing using direct flux calculations with tetrahedral surface interpolation 
(black line), bulk tracer calculations (thick grey line) and bulk tracer 
calculations corrected for the presence of the moist cloud shell (thin grey 
line).}\label{fig:resolution_dependence}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=19pc,angle=0]{./figures/interpolation_bias}\\ 
  \caption{Schematic showing interpolation bias which leads to underestimates
  of cloud volume.
  }\label{fig:interpolation_bias}
\end{figure}

\begin{figure}[t]
  \noindent\includegraphics[width=39pc,angle=0]{./figures/area_comparison}\\ 
  \caption{Profiles of cloud core fraction calculated without interpolation 
  (grey line) and with tetrahedral interpolation (black line) at 25m, 50m, 
  and 100m grid spacings.
  }\label{fig:area_comparison}
\end{figure}

\end{document}
