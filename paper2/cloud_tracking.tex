%% Copernicus Publications Manuscript Preparation Template for LaTeX Submissions
%% ---------------------------------
%% This template should be used for the following class files: copernicus.cls, copernicus2.cls, copernicus_discussions.cls
%% The class files, the Copernicus LaTeX Manual with detailed explanations regarding the comments
%% and some style files are bundled in the Copernicus Latex Package which can be downloaded from the different journal webpages.
%% For further assistance please contact the Publication Production Office (production@copernicus.org).
%% http://publications.copernicus.org


%% Differing comments regarding the specific class files are highlighted.


%% copernicus.cls
\documentclass[acp]{copernicus}

%% copernicus2.cls
%\documentclass[acp]{copernicus2}

%% copernicus_discussions.cls
%\documentclass[journal abbreviation, hvmath, online]{copernicus_discussions}


\begin{document}


\title{Statistical analysis of a LES shallow cumulus cloud ensemble using a 
cloud tracking algorithm}


\author[1]{Jordan T Dawe}
\author[1]{Philip H Austin}

\affil[1]{Department of Earth and Ocean Sciences, 
        University of British Columbia, 
	6339 Stores Road, 
        Vancouver, BC, 
        V6T 1Z4}

%% The [] brackets identify the author to the corresponding affiliation, 1, 2, 3, etc. should be inserted.



\runningtitle{CLOUD TRACKING}

\runningauthor{Dawe and Austin}

\correspondence{Jordan T Dawe\\ (jdawe@eos.ubc.ca)}



\received{}
\pubdiscuss{} %% only important for two-stage journals
\revised{}
\accepted{}
\published{}

%% These dates will be inserted by the Publication Production Office during the typesetting process.


\firstpage{1}

\maketitle



\begin{abstract}
A technique for the tracking of individual clouds in an large eddy simulation 
model is presented.  We use this technique on a Large Eddy Simulation (LES) of 
a shallow cumulus cloud field based upon the Barbados Oceanographic and 
Meteorological Experiment (BOMEX), to calculate statistics of cloud height, 
lifetime, and other physical properties for individual clouds in the model.  We 
also examine the question of nature versus nurture in shallow cumulus clouds: 
do properties at cloud base determine the upper-level properties of the clouds 
(nature), or are cloud properties determined by the environmental conditions 
they encounter (nurture).  We find that clouds which ascend through an 
environment that has been pre-moistened by previous cloud activity are no more 
likely to reach the inversion than clouds that ascend through a drier 
environment.  Cloud base thermodynamic properties are uncorrelated with 
upper-level cloud properties, while integrated entrainment and detrainment
displays moderate correlations up to the inversion.  conversely, cloud base area 
influences upper-level cloud area and maximum cloud height.  We conclude that 
cloud thermodynamic properties are primarily influenced by entrainment and 
detrainment processes, cloud area and height are primarily influenced by cloud 
base area, and thus nature and nurture both play roles in the dynamics of 
BOMEX shallow cumulus clouds.
\end{abstract}

%% only used for copernicus2.clsu
%\abstract{
% TEXT
% \keywords{TEXT}}

\introduction
%% \introduction[modified heading if necessary]

Shallow cumulus clouds occur over large parts of the trade-wind regions 
\citep{Norris1988}, where subsiding air creates stable atmospheric conditions.  
They form an important part of the tropical Hadley circulation, acting to 
transport heat and moisture away from the surface, erode the inversion, and 
precondition the free troposphere for deep convection \citep{Tiedtke1988, 
Neggers2007}.  Additionally, since short-wave radiation reflection from marine 
boundary-layer clouds is a primary component of cloud radiative effects, 
accurate parametrization of shallow cumulus is necessary to accurately model 
global radiation balance in General Circulation Models 
\citep[GCMs;][]{Bony2005, Medeiros2008, Wyant2009, Medeiros2011}.
  
Much effort has been devoted to understanding the dynamics of shallow cumulus, 
notably the work of the Global Energy and Water Cycle Experiment (GEWEX) Cloud 
System Studies \citep[GCSS;][]{Randall2003} boundary layer cloud group.  The 
GCSS have created several idealized test cases, based upon field campaigns, 
suitable for modelling via Large Eddy Simulation \citep[LES;][]{Siebesma1995, 
Stevens2001, Brown2002, Ackerman2009, vanZanten2011}.  These studies have 
generally examined cloud fields in bulk, taking large-scale conditionally 
sampled mean values of quantities and fluxes.  This approach provides 
information about the mean cloud field properties, but averages out any 
information concerning the dynamics of individual clouds.

A few researchers have focused instead on simulating the dynamics of individual
clouds. Early work by \cite{Klaassen1985}, \cite{Bretherton1989} and 
\cite{Grabowski1991} performed two-dimensional simulations of a single 
cloud.  These were quickly followed by fully three-dimensional simulations 
\citep{Grabowski1993, Grabowski1993a, Carpenter1998, Blyth2005}, which 
simulated individual clouds initiated via the application of localized heat 
fluxes.  Unfortunately, none of these studies were able to examine how 
individual clouds might be affected by the presence of many other clouds in a 
cloud field.  To address this \cite{Zhao2005, Zhao2005a} manually selected six 
from a fully-developed LES cloud field, and analyzed their life cycles.  A 
similar approach was taken by \cite{Heus2009}, who used a virtual-reality 
environment to help select 79 clouds from a set of LES experiments.

While the methods of \citeauthor{Zhao2005} and \citeauthor{Heus2009} were 
able to provide many insights into the dynamics of individual clouds in a 
LES cloud field, they still suffer from two issues.  First, they are time 
consuming, requiring human intervention to select individual clouds out of 
the model simulations, and second, they do not allow for a complete 
decomposition of a cloud field into individual clouds.  Ideally one would 
prefer an automated system that would be able to identify all individual clouds 
in an LES simulation and track them through their life history.

Two previous studies have looked at automated cloud identification and tracking 
in LES. \cite{Jiang2006} used a two-dimensional image registration algorithm 
to measure the effect of aerosols upon cloud lifetimes (Graham Fiengold, 
personal communication).  This method of tracking has the benefit of 
simplicity, but will lump together clouds which overlap vertically but are not 
physically contiguous.  More recently, \cite{Plant2009} presented a tracking 
algorithm that was able to capture the complete time evolution of each cloud in 
an Cloud Resolving Model (CRM). This algorithm operates while the CRM is 
running, examines cloud relationships at each time step of the CRM, and outputs 
diagnostics for each individual cloud.

Here we present a fully automated algorithm for the tracking of individual 
clouds in a LES. This algorithm generates output similar to the algorithm 
created by \cite{Plant2009}, but with one significant difference: it can be 
run off-line, on pre-computed LES model fields.  In section 2 we describe the 
BOMEX LES we analyzed.  Section 3 presents the cloud tracking algorithm itself, 
and presents an overview of the statistics generated by the algorithm.  Then in 
section 4 we use the output generated by the algorithm to address the question 
of whether initial cloud properties or the environment encountered by the cloud 
is more important in determining the course of the cloud's life cycle.  
In section 5 we present our conclusions.  In addition, we include the full 
source code for our algorithm for use by the LES modeling community, written in 
the Python programming language, as supplemental material to this paper.

%==============================================================================

\section{Model Description}

All LES calculations in this paper were made using the System for Atmospheric 
Modeling \citep[SAM;][]{Khairoutdinov2003}.  The model was run configured as 
standard GCSS Barbados Oceanographic and Meteorological Experiment 
\citep[BOMEX;][]{Holland1973, Siebesma2003} experiment.  BOMEX simulates a 
idealized steady-state trade-wind cumulus cloud field based on observations 
made over ocean near Barbados during June, 1969.  Constant latent and sensible 
surface heat fluxes, and constant large-scale moisture advection, subsidence, 
and radiative forcings drive the model.  The BOMEX cloud field was 
nonprecipitating and so precipitation is disabled in the model code.  Cloud 
base begins at 500 m height with maximum cloud fraction reached at 600 m, and 
the base of the inversion is roughly at 1500 m.

The BOMEX run was performed on a 6.4 km x 6.4 km horizontal x 3.2 km vertical 
domain with 25 meter grid resolution in all directions and a one second time 
step.  The model was run for 6 hours of model time, and the first three hours 
of simulation were discarded as the model was still adjusting into steady 
state. During the run the model steadily emits a numerical tracer from the 
surface which decays exponentially over time with a one minute time constant.  
This tracer is used to implement the conditional sampling of 
\cite{Couvreaux2010} in order to track cloud plumes in the dry sub-cloud 
layer.  Model fields were output every minute for the last three hours of the 
simulation.

%==============================================================================

\section{Cloud Tracking}

Dividing a cloud field up into individual clouds at a single moment in time is 
a trivial matter of finding connected cloudy regions.  Tracking the resulting 
clouds from one time step to the next is more problematic, as a cloud is a 
process, not a consistent physical object.  A rising parcel of moist air may 
condense, a parcel of air containing condensate may evaporate, and a cloud 
may merge with another cloud or split into multiple clouds.  To handle all of 
these possible events, we adopt a more complex definition of what constitutes 
a cloud.

\subsection{Cloud Tracking Algorithm}

We begin by defining three cloud regions (Fig. \ref{fig:vertical_section}).  
The first is the cloud ``core", defined following \cite{Siebesma1995} as all 
model points containing condensed liquid water which have positive buoyancy and 
upward velocity.  The second we refer to as the ``condensed" region, defined 
simply as all model points containing condensed liquid water.  Third is the 
cloud ``plume", the region of upward moving air that is associated with the 
cloud.  We define this region following the work of \cite{Couvreaux2010} via a 
numerical tracer that is emitted at the surface and subsequently decays 
exponentially with a one minute time constant.  A point is considered to be in 
the plume if the tracer value of that point is larger than one standard 
deviation above the mean tracer value at the current height.  Additionally, 
the tracer value must exceed five percent of the mean of the horizontal 
standard deviation of the tracer values from the surface to the current height.  
However, unlike \citeauthor{Couvreaux2010}, we do not require upper-level 
plume points to have condensed liquid water.  Finally, we force the condensed 
region to be a subset of the plume by setting all condensed points to also be 
plume points.

Next, we divide the cloud field into ``cloudlets" by assigning core points 
which are nearest-neighbour adjacent to the same cloudlet.  These core 
cloudlets are then expanded into nearest-neighbour connected condensed points 
until all connected condensed points are assigned to a cloudlet.  Condensed 
points cannot belong to two cloudlets, so if a cloud contains more than one 
contiguous volume of nearest-neighbour connected core points it will be split 
into separate cloudlets.  Leftover condensed points are then divided into new 
cloudlets which have no cores.  Once all the condensed points have been 
assigned to cloudlets, this expansion process is repeated for the plume points.  
This results in three types of cloudlets: ones consisting of core and condensed 
points surrounded by plume, ones consisting only of condensed points surrounded 
by plume, and ones consisting only of plume points. This process is then 
repeated for every saved model time step.

These cloudlets are then assigned to individual clouds.  For the first time 
step, we assign cloudlets which have nearest-neighbour connected condensed 
regions to the same cloud.  At subsequent time steps, cloudlets that spatially 
overlap with a cloud at the previous time step are assumed to be the same 
cloud.  For the purpose of determining cloudlet overlaps, the cloudlet's 
position is corrected for advection that has occurred between snapshots using 
the mean velocity of the cloudlet's condensed points (if condensed points are 
present in the cloudlet) or plume (if they are not).

Four kinds of overlap are possible: condensed points in the cloudlet may 
overlap condensed points in a previous time step cloud 
(condensed$\rightarrow$condensed); condensed points may overlap previous 
plume points (plume$\rightarrow$condensed); plume may overlap condensed 
points (condensed$\rightarrow$plume); and plume may overlap plume 
(plume$\rightarrow$plume).  Several kinds of overlap may occur 
simultaneously, so we define a hierarchy of connection types and check each in 
turn.  The strongest connection type is condensed$\rightarrow$condensed, 
followed by plume$\rightarrow$condensed, then plume$\rightarrow$plume.  
Condensed$\rightarrow$plume connections are ignored, which prevents 
connections between newly formed cloudlets and leftover plume from a 
dissipating cloud.  Conversely, allowing plume$\rightarrow$condensed 
connections lets us associate newly condensed clouds with plumes rising through 
the sub-cloud layer.  Only the strongest connection type present for a given 
cloudlet is considered: if a cloudlet has condensed$\rightarrow$condensed 
connections, any condensed$\rightarrow$plume or plume$\rightarrow$plume 
connections are ignored, and if there are condensed$\rightarrow$plume 
connections, plume$\rightarrow$plume connections are ignored.  

A cloudlet may connect to more than one cloud, which is used to identify merges 
and splits (Fig. \ref{fig:cloudfinder_instructions}).  Any cloudlet which 
overlaps more than one cloud at the previous time step is considered to be the 
result of a merge between the two clouds.  In this case the cloudlet is 
assigned to the cloud with the largest overlap, and the other overlapping 
clouds are assumed to have merged with the largest overlap cloud.  Next, clouds 
that connect to more than one cloudlet are considered for splitting.  Splits 
occur only if a cloud contains more than one cloudlet whose plume is in contact 
with the ground, with the largest cloudlet being assigned to the original cloud 
and the smaller sub-clouds becoming new clouds. Cloudlets which are not 
connected to the ground are assigned to the nearest ground-connected cloud, 
measured by the distance between the centroids of the cloud and cloudlet.  Any 
cloudlets that do not overlap clouds in the previous time step are assumed to 
be newly formed clouds.  This process of cloudlet assignment, merging, 
splitting, and creation is repeated for each time step until all cloudlets are 
assigned to a cloud.
  
Once the cloudlets are all assigned to a cloud, any cloud that has condensed 
points for less than five minutes is flagged.  If any merge or split events 
occurred over these clouds' short lifetimes, the cloud is rejoined to the cloud 
it split from or merged into.  This prevents decaying detritus shed from a 
cloud top and clouds which split then immediately re-merge with their parent 
from being counted as discrete cloud objects.  Finally, clouds that have 
condensed liquid water for less than two minutes, and thus are unconnected to 
future or past clouds, are placed into a ``cloud noise" group consisting of a 
mixture of ``mistakes" in the tracking algorithm and short-lived, dynamically 
forced clouds at cloud base. 

\subsection{Cloud Tracking Results}

Applying the cloud tracking algorithm to three hours of BOMEX LES output 
resulted in 3171 tracked clouds.  Of these, 609 (19\%) were created by 
splitting an existing cloud, 2381 (75\%) were unassociated with previous 
clouds, and 181 (6\%) were present at the start of the output period and thus 
their initiation was not observed.  Conversely, 261 (8\%) of the clouds ended 
their life cycle by merging with another cloud, 2820 (89\%) ended their 
life cycle by decaying away, and 90 (3\%) were present at the end of the output 
period.  Only 20 clouds both begin by splitting from and end by merging with 
another cloud, indicating that 850 clouds in total (609 created via splitting 
plus 261 destroyed via merging minus 20 which do both, 27\%) are involved in 
such interactions--a sizable proportion of the field.  The larger number of 
clouds present at the start of the output period (181) than at the end (90) is 
the result of the algorithm maintaining connections between physically separate 
clouds at the end of the output period.

Figure \ref{fig:example_cloud} displays horizontally averaged cloud properties 
for the longest-lived cloud in the ensemble.  The cloud's cross-sectional area 
shows large, vertically coherent discontinuities in time due to merge events 
and split events.  However, the majority of the merge and split events that 
occur to this cloud do not significantly alter the cloud area, and none of the 
other horizontally averaged properties display significant discontinuities.  
Most of the cloud maintains upward velocities over 1 m s$^{-1}$ (Fig. 
\ref{fig:example_cloud}b), though short-lived downdrafts are apparent in the 
inversion (above $\approx$ 1.5 km) and at the end of the cloud's life.  Near 
cloud base, the total specific water ($q_t$, units of g kg$^{-1}$, Fig. 
\ref{fig:example_cloud}c), liquid-water potential temperature ($\theta_l$, 
units of K, Fig. \ref{fig:example_cloud}d), and condensed liquid water 
($q_l$, units of g kg$^{-1}$, Fig. \ref{fig:example_cloud}e) are similar to 
the environmental properties near cloud base but the $q_t$ excess, $\theta_l$ 
deficit, and $q_l$ of the cloud increases with height and indications of 
upward propagating pulses can be seen in these fields.  The cloud buoyancy is 
generally positive below the inversion, with strong pulses of positive buoyancy 
apparent (displayed using density potential temperature $\theta_\rho$, units 
of K, Fig. \ref{fig:example_cloud}f).  Finally, comparing this example cloud 
with the example clouds presented by \citet[][figs. 4 and 5]{Heus2009} shows 
similar magnitudes and patterns in cloud properties.

Core properties (with cloud core defined as cloud points having upward velocity
and positive buoyancy) for the same cloud (Fig. \ref{fig:example_core}) 
display buoyant mass pulses more clearly than the cloud properties.  Cloud core 
occupies roughly 60\% the horizontal cloud area near cloud base, but 
essentially vanishes in the inversion.  Since the cloud properties show 
positive vertical velocity and negative buoyancy in the inversion, the 
disappearance of the core is due to the rapid increase of environmental 
stability, which makes the cloud negatively buoyant.  Cloud core vertical 
velocity increases steadily with height and $q_t$ excess, $\theta_l$ deficit, 
and $q_l$ are all greatest at cloud top.  Core buoyancy is positive by 
definition, and regular buoyant pulses are apparent.

\subsection{Tracked Cloud Statistics}

In this section we will examine the statistics of the cloud population 
generated by the cloud tracking algorithm.  Before calculating these 
statistics, we removed any clouds which begin or end outside the model output
period since we do not have access to their complete life cycles. This removed 
287 clouds from the sample, leaving 2,921.  This filtering will tend to remove 
some of the longest-lived clouds from our sample, biasing the population 
slightly.  However, our results show the cloud population to be overwhelmingly 
composed of short-lived clouds, implying that robust estimates of the frequency 
of occurrence of the longest-lived clouds will not be possible in any case.

Both cloud lifetime (Fig \ref{fig:cloud_stats}a) and mean cloud mass over the 
cloud's lifetime (Fig \ref{fig:cloud_stats}b) are heavily skewed toward small, 
short-lived clouds.  Over 1,000 of the tracked clouds, a little less than a 
third of the total cloud population exist for less than 4 minutes, and nearly 
1,500 clouds are smaller than 5,000 m$^2$ (8 model grid cells), or about a half 
of the cloud population.  Conversely, there are four clouds that persist for 
longer than an hour (not shown), and 23 with mean horizontal areas larger than 
150,000 m$^2$ (240 model grid cells, not shown).  The cloud lifetime 
distribution displays no clouds with a lifetime shorter than two minutes, due 
to our imposed constraint that tracked clouds be present at more than one model 
output time.  The average cloud lifetime is 7.2 minutes, and the average area 
is 10,050 m$^2$ (16 model grid cells).

Maximum cloud height is much less skewed than lifetime and area, but still 
shows many more small clouds than large clouds (Fig. \ref{fig:cloud_stats}c).
Only 441 clouds, or about 15\% of the population, reach a height of 1 km, and 
only 108 clouds (4\%) reach the inversion base at 1.5 km.  Over 78\% of the 
clouds have cloud base between 500 and 600 m, with the majority of the rest 
having cloud base values below 1 km (Fig. \ref{fig:cloud_stats}d).  Thus, the 
overall picture of the cloud field we form is of numerous small, short-lived 
clouds at cloud base, interspersed with occasional large, long-lived towers 
that have managed to overcome convective inhibition and reach the inversion.

As cloud size distributions have been shown to be consistent with power law 
scalings \citep{Benner1998, Zhao2007}, these results are physically plausible. 
However, few of these statistics have been accurately measured in real cloud 
fields. One cloud property that has been widely measured, however, is 
horizontal cloud area taken from satellite and aircraft images 
\citep{Benner1998, Cahalan1989, Neggers2003, Neggers2003a, Zhao2007, 
Jiang2008}.  The number of clouds of a given size has been found to follow a 
power-law distribution of the form:
\begin{equation}
n(l) \propto l^{-\lambda}
\end{equation}
where $l$ is a horizontal length scale in meters generated by taking 
$l=\sqrt{a}$, where $a$ is the horizontal area of the cloud.  $\lambda$ can 
be calculated by finding the slope of a line fit to a log-log plot of the 
relative number of clouds present at each length scale $l$.  Often this 
relationship is complicated by a scale break near $l$ = 1000 m, and two power
laws are fit, one for clouds with $l$ smaller than $\approx$ 1000 m and 
another for clouds with $l$ larger than $\approx$ 1000 m.

To calculate the cloud size distribution, we follow \cite{Neggers2003} and 
take the projection of the clouds onto a horizontal plane to simulate what a 
satellite directly overhead would observe, to facilitate comparison with 
observations.  We then take the square root of the projected cloud area to 
generate a length scale, calculate a cloud size histogram with 10 meter wide 
bins at each minute over the three hours of model output, then fit a line to 
this distribution in log-log space.  We do this twice, once for cloud sizes 
produced by the tracking algorithm, and once using cloud areas taken directly 
from snapshots of the model output.

Comparing the size distribution generated from snapshots with the distribution 
generated by the tracking algorithm shows the tracking algorithm modifies
the cloud size distribution by increasing the number of clouds between 100 and 
1000 m length scales, and removing clouds smaller and larger than this range 
(Figure \ref{fig:cloud_areas}).  The algorithm removes small clouds for two 
reasons: first, we explicitly filter out clouds that are present in only one 
snapshot; and second, the tracking algorithm treats short-lived clouds which 
have recently separated from a parent as part of the parent cloud.  Large
clouds are underrepresented by the algorithm for two reasons: first, clouds 
which have connected condensed regions may still have separate cores, and so 
are considered separate clouds by the algorithm; and second, the projection of 
the three dimensional cloud area onto the 2D plane done for the instantaneous 
snapshots results in clouds which overlap in the vertical, but which are 
disconnected in 3D space, inflating the numbers of large clouds seen in the 
snapshots.  Many of the small and large clouds thus end up classified as mid-
sized clouds by the tracking algorithm, inflating their numbers.

Clear scale breaks appear around 1000 m in the snapshot distribution and 900 m 
in the tracking algorithm distribution, and so we exclude length scales greater 
than 1000m and 900 m from the line fits used to find $\lambda$.  Additionally, 
a small-length scale scale break is apparent in the tracking algorithm 
distribution for clouds with $l$ less than 100 m, so we exclude this length 
scale from the tracking algorithm line fit as well.  Lines fit to the 
distributions result in reasonably similar values of $\lambda$: 1.88 for 
the snapshots, and 1.96 for the tracking algorithm (Figure 
\ref{fig:cloud_areas}).  These $\lambda$ values also compare favorably 
with previous estimates taken from LES (1.7, \citeauthor{Neggers2003},
\citeyear{Neggers2003}; 1.9, \citeauthor{Jiang2008}, \citeyear{Jiang2008}), 
satellite observations (1.89, \citeauthor{Cahalan1989},
\citeyear{Cahalan1989}; 1.88, \citeauthor{Zhao2007}, \citeyear{Zhao2007})
and airplane observations (1.98, \citeauthor{Benner1998}, 
\citeyear{Benner1998}; 2.3, \citeauthor{Jiang2008}, \citeyear{Jiang2008}).
Thus, while the tracking algorithm modifies the total numbers of small, medium, 
and large clouds in the distribution, the power law scaling for the medium 
clouds is not significantly distorted.

%==============================================================================

\section{Two example analyses}

The output of the tracking algorithm provides us with a complete decomposition 
of the model cloud field into individual clouds.  This allows us the 
opportunity to generate statistics of cloud behaviour and use these statistics 
to answer questions about cloud field dynamics.  Here we present two examples 
of analyses that would not be possible without a large database of tracked 
clouds.

Before we turn to our examples, we briefly examine the variability of the 
clouds in the tracked ensemble.  We examine six basic properties of the 
clouds: total specific water $q_t$, liquid-water potential temperature 
$\theta_l$, density potential temperature $\theta_\rho$, vertical velocity 
$w$, cross-sectional area $a$, and vertical mass flux $M$.  We take horizontal 
averages of the first four properties and horizontal sums for $a$ and $M$ over 
all the points containing condensed liquid water associated with a cloud to 
generate property profiles for each cloud at each sampled time.

Cross-correlations between properties of each cloud sample at a given height 
reveal strong instantaneous relationships between cloud properties (Figure 
\ref{fig:cloud_autocorrelation}).  Above 800 m, $q_t$, $-\theta_l$, and 
$\theta_\rho$ are strongly correlated, to the point that they can essentially 
be considered a single variable; more buoyant clouds have higher $q_t$ and 
lower $\theta_l$.  Similarly, $a$ and $M$ have near-unity correlations above 
600 m, indicating that variations in cross-sectional area completely control 
the cloud's vertical mass flux.  From this we conclude that BOMEX cloud 
variability between 800 m and the inversion base can be completely 
characterized by three variables: $\theta_\rho$, $w$, and $a$.  

Near cloud base the system becomes slightly more complicated, as $a$ and $M$ 
become uncorrelated at cloud base, and $-\theta_l$ diverges from $q_t$ and 
$\theta_\rho$.  At cloud base, buoyancy is completely controlled by 
variations in $q_t$, and $-\theta_l$ becomes anti-correlated with $q_t$ and 
$\theta_\rho$.  Within the 700-1400 m layer cross-correlations are 
significant at the 99\% confidence level between $\theta_\rho$, $w$, and $a$, 
but the magnitude of these relationships is much weaker, with a correlation of 
$\approx$ .75 between $w$ and $\theta_\rho$, $\approx$ .4 between $a$ 
and $\theta_\rho$, and $\approx$ .4 between $w$ and $a$.  Once the clouds 
reach the inversion layer, these cross-correlations between $w$, 
$\theta_\rho$ and $a$ are no longer statistically significant.

Some of the reasons for the appearance of these strong cross-correlations 
between cloud properties can be inferred from the vertical structure of the 
standard deviations of the cloud properties (Figure \ref{fig:st_dev}).  Again, 
the properties naturally divide themselves into three groups: variability in 
$q_t$, $\theta_l$ and $\theta_\rho$ steadily increases with height, 
variability in $a$ and $M$ is relatively constant with height, and $w$ falls 
somewhere between these two extremes.  This suggests that all the BOMEX clouds 
begin with similar thermodynamic properties which are modified by mixing events 
as the clouds rise, resulting in accumulating variability that is strongly 
correlated.  Conversely, the BOMEX clouds start with a wide range of areas at 
cloud base, and as they rise this variation changes little.  Finally, 
the clouds start with some variability in their vertical velocity at cloud 
base, which increases as they rise due to forcing from the range of buoyancies 
the clouds develop.  This suggests that cloud area and mass flux results from 
the cloud's nature (inital conditions), and thermodynamic variables are 
governed by nurture (the environmental conditions they experience).  We examine
this question further in the next section.

\subsection{Nature versus Nurture}

In this section, we perform analyses on the tracking algorithm output to 
address the question of nature versus nurture in shallow cumulus cloud 
dynamics: do the properties of the air entering the cloud at cloud base, or the 
properties of the environmental the cloud encounters as it rises, exert 
stronger influence on the evolution of the cloud?  \cite{Romps2010} addressed 
this question for individual parcels of convecting air and found the net 
entrainment experienced by a parcel influences the parcel's state far more than 
the parcel's inital properties at cloud base.  Our tracking algorithm allows us 
to examine this question from the prospective of whole clouds, instead of 
sub-cloud parcels.

We use a simple one-dimensional particle tracking model to examine the causes 
of variability in upper-level cloud properties.  For each cloud, we release a 
particle once a minute at some initial height and advect it vertically using 
the average vertical profile of $w$ in the cloud.  Linear interpolation is 
used to calculate $w$ between model grid points and sampling times, and forward 
differencing is used to step the particle position in time with a time step of 
1 s.  The time at which the particles reach each higher model level are then 
recorded until the particle leaves the cloud (Figure 
\ref{fig:cloud_base_schematic}a).  

These time-height profiles are then used to sample the mean properties of the 
cloud when the released particles reach each model level (Figure 
\ref{fig:cloud_base_schematic}b and c).  We then combine the results from each 
cloud in the simulation to produce correlations between the cloud properties 
when the particles are released and when they reach each model height (Figure 
\ref{fig:cloud_base_schematic}d).  If a particle does not reach a given 
height, it is simply excluded from the correlation calculation.  This allows us 
to determine to what extent the properties of the cloud near cloud base control 
the future properties of the cloud at height.

We use the 99\% significance level as a rough measure of the height at which 
the cloud properties are decorrelated from the properties at particle release.  
However, since clouds tend to experience discrete mass flux pulses on a 
$\approx$ 15 minute timescale and we release one particle each minute, we 
divide the degrees of freedom (number of particles) used to calculate the 
correlation significance by a factor of 15 to account for the auto-correlation 
of cloud properties within a pulse.

First, we perform this calculation using particles released from a height of 
300 m, in the sub-cloud layer.  Since clouds do not appear in the sub-cloud 
layer, we use the horizontal mean properties of the cloud plume region to 
advect the particles and calculate property values; a total of 8012 particles 
are released at 300 m.  For this calculation we ignore plume area and vertical 
mass flux, because the method we use to divide the sub-cloud plume up between 
individual clouds links the areas of the sub-cloud plume to that of the cloud
above.

The $q_t$ of the rising particles is strongly correlated with the $q_t$ at 
release until the particles reach cloud base at 500 m (Figure 
\ref{fig:sub_cloud_profiles}).  The mean $\theta_l$ and $\theta_\rho$ of 
the plume are also strongly correlated with release properties.  This implies 
that the sub-cloud plume properties propagate upward essentially unchanged by 
interaction with surrounding air.  $q_t$ is anti-correlated with $\theta_l$ 
with a value of $\approx$ 0.6 in the sub-cloud layer, and does not show 
significant correlations with $\theta_\rho$.  Conversely, $\theta_\rho$ is 
strongly correlated with $\theta_l$ but not with $q_t$; thus, while in the 
cloud-layer buoyancy is controlled by $q_t$, in the sub-cloud layer, it is 
controlled by $\theta_l$.  The $w$ of the rising particles is uncorrelated 
with any other properties at particle release with the exception of the 
velocity, but unlike the thermodynamic variables this correlation steadily 
declines and become insignificant 200 m above the particle release level, 
indicating the vertical velocity is strongly modified in the sub-cloud layer.  
The transition from the sub-cloud layer into cloud base fully decorrelates the 
$w$ and $\theta_\rho$ of the cloud with the sub-cloud properties at 300 m.
Only $q_t$ and $\theta_l$ properties survive the transit through cloud base, 
but the correlation with the sub-cloud properties is limited to the first 200 m 
above cloud base.

Next we look at correlations profiles for particles released at 600 m, the 
height of maximum cloud fraction in the middle of the cloud base layer.
For this height we use the horizontal mean of the cloud core properties to 
advect the particles and calculate cloud properties, as the cloud core 
definition insures the particles will always move upward.  A total of 
9984 particles are released and tracked.  Due to the strong cross-correlations 
between thermodynamic variables and cloud area and mass flux, we restrict our 
analysis to $\theta_\rho$, $w$, and $a$.  However, since $\theta_l$ is 
uncorrelated with $q_t$ and $\theta_\rho$ at cloudbase, we do calculate the 
correlation between $\theta_l$ at 600 m and upper-level properties separately 
from cloud base $\theta_\rho$.

Cloud base $\theta_l$ turns out to be uncorrelated with any upper-level 
cloud properties (Figure \ref{fig:cloud_base_profiles}).  Correlations between 
$\theta_\rho$ at cloud base and at height decline rapidly, dropping below 
0.5 by 800 m and losing all statistical significance around 1,000 m.  Cloud 
base $w$ and $a$ are correlated with $\theta_\rho$ at cloud base at levels of 
0.25 and 0.5, respectively, and this correlation also falls to insignificance 
by 1000 m.  Vertical velocity shows a similar pattern, with all correlations 
becoming insignificant near 1,000 m.  Cloud core area, on the other hand, 
is significantly correlated with cloud core area at cloud base all the way up 
to the inversion base at 1,500 m.  Cloud base $w$ is also significantly 
correlated with upper-level cloud core area up to 1,300 m, but with a much 
smaller correlation.  In summary, upper-level thermodynamic properties and 
vertical velocity appear to be uncorrelated with cloud-base properties, but 
upper-level cloud core area is correlated with cloud base $a$ and, to a lesser
extent, $w$.

\cite{Romps2010} explained the variation in cloud parcel properties at height 
as the result of the entrainment the parcel experienced as it rose from 
cloud base.  We can examine the influence of entrainment and detrainment 
processes on the cloud core properties by integrating the total fractional 
entrainment $\epsilon$ (in units of m$^{-1}$) and fractional detrainment 
$\delta$ (also in m$^{-1}$) experienced by the particle between 600 m and the 
current height, and correlating these integrated $\epsilon$ and $\delta$ 
values with the properties of the cloud core at the current height.  To do this 
we calculate cloud core mass entrainment and detrainment rate profiles for each 
individual cloud using the direct entrainment method detailed in 
\cite{Dawe2011}, and divide these profiles by the cloud core vertical mass 
flux of each cloud to generate individual $\epsilon$ and $\delta$ values for 
each cloud at each particle sampling time.  Additionally, we calculate the 
integral of the critical mixing fraction $\chi_c$, the fraction of 
environmental air in a mixture of core and environmental air needed to produce 
a neutrally buoyant mixture.  $\chi_c$ is used in buoyancy-sorting 
parametrization schemes to determine cloud core entrainment and detrainment 
rates \citep{Kain1990, Rooy2008}.  We calculate $\chi_c$ using the mean cloud
core properties and environmental properties taken as the average of all 
non-cloud core points at the current height within 100 m of the cloud core.

Cloud core $\theta_\rho$ is anti-correlated with integrated $\epsilon$ and 
$\delta$, and correlated with integrated $\chi_c$, with a constant magnitude 
of roughly 0.5 up to 1,400 m. These correlations become stronger than the 
correlation with cloud base $\theta\rho$ roughly 200 m above particle 
release, and indicate that low entrainment and detrainment rates are correlated 
with anomalously buoyant clouds.  Vertical velocity also shows stronger 
correlations with $-\epsilon$, $-\delta$, and $\chi_c$ than with cloud base 
$w$ between 800-1,300 m, although in this case integrated $-\delta$ has a 
noticeably higher correlation with $w$ than $-\epsilon$ does.  Conversely, 
cloud core area is more correlated with cloud base core area than integrated 
$-\epsilon$, $-\delta$ or $\chi_c$ all the way to the inversion base, at 
which point the integrated $-\delta$ and $\chi_c$ values show roughly the 
same correlation with $a$ as cloud base area.  Integrated $-\epsilon$ is far 
less correlated with $a$, however, showing that cloud area variations are more 
influenced by detrainment than entrainment.

\subsection{Ascending cloud top properties versus maximum cloud height}

In this section, we examine the effect that the properties of the cloud top and 
the environment the cloud encounters as it ascends has upon the eventual height 
the cloud achieves.  Using the cloud tracking data, we identify the earliest 
times that cloud is present at each height during each cloud's ascent 
(Fig. \ref{fig:cloud_environment_schematic}a).  We then find all cloud points 
in the cloud at those heights and time, and take averages of the properties of 
those points to generate vertical profiles of the ascending cloud top 
properties (Fig. \ref{fig:cloud_environment_schematic}b).  At the same time, 
we find all environment points that are nearest-neighbour adjacent to the cloud 
top points and generate profiles of the environment in direct contact with the 
rising cloud top.

From these profiles, we perform two analyses based upon the average of the 
property profiles between 550-750 m and between 750-1000 m.  In order to not 
bias these averages, any cloud profiles which do not span the whole averaging 
range are excluded from the analysis.  Clouds whose life histories begin or end 
outside the data period are also discarded.  From the original set of 3,171 
clouds, this leaves 267 clouds in the 550-750 m case and 240 clouds in the 
750-1000 m case.

The clouds that remain are then split into two categories: tall clouds which 
exceed a threshold height over their lifetime, and short clouds which do not.  
The threshold height is chosen in each case to divide the cloud sample roughly 
equally.  For the clouds present between 550-750 m, we set the dividing 
height to 1125 m; for the clouds present between 750-1000 m, we set the 
dividing height to 1300 m.  This results in 131 tall clouds and 136 short 
clouds in the 550-750 m case, and 127 tall and 113 short clouds in the 
750-1000 m case.

Since many of the cloud's properties, such as cross-sectional area, are not 
normally distributed, we use a non-parametric statistical test to determine if 
the properties of the tall clouds and their environment are significantly 
different than the properties of the short clouds.  The Mann-Whitney U test 
evaluates the null hypothesis that two data samples come from the same 
distribution \citep{Mann1947}.  It does this by summing the number of values 
in one sample which are greater than each value in the other sample; this sum 
is called $U$.  If large samples are taken from populations with identical 
distributions, on average one would expect a given value from the first sample 
to be larger than half the values in the other sample, and $U$ will be normally 
distributed with a mean value of $mn/2$.  Thus, the further $U$ is from $mn/2$, 
the more likely it is that the two samples come from distributions with 
differing magnitudes.  Note that there are actually two U values defined by 
this test, depending on whether the first sample is ranked against the second, 
or the second is ranked against the first.  However, it is easy to show that 
$U_1 + U_2 = mn$, and by convention only the smaller U-value is quoted.

We calculate U values for total specific water $q_t$, liquid-water potential 
temperature $\theta_l$, density potential temperature $\theta_\rho$, and 
vertical velocity $w$ for both cloud top and environment.  Three additional 
quantities are calculated for cloud top alone: specific liquid water $q_l$, 
cross sectional area $a$, and vertical mass flux $M$ (in units of kg s$^{-1}$).  
All of these values are calculated for both averages over 550-750 m and 
750-1000 m, resulting in a total of 22 property comparisons.  For the 550-750 m 
samples, if both the tall and short clouds have identical distributions the 
mean value of $U$ should be 8908, and for the 750-1000 m samples, 7175.  

Since we are calculating 22 separate tests, there is a high chance that one of 
these tests will show a spurious significant relationship if we test for a 95\% 
significance level.  Several methods, such as the Bonferonni correction 
\citep{Shaffer1995}, can be used to reduce the possibility of finding a 
spurious result.  However, these methods often risk erroneously excluding 
significant results, and much debate over their use can be found in the 
scientific literature \citep{Perneger1998, Nakagawa2004}.  The simplest 
correction to significance for multiple statistical tests is simply to divide 
the p-value sought by the number of tests performed.  Thus, to achieve an 
overall p-value of 0.05 with 22 tests, we must achieve a p-value of .05/22 = 
0.0023 on an individual test. This represents a worst case scenario where only 
one of the 22 tests is significant, and we must exclude the possibility this 
significance results from random chance; if more than one test is significant, 
the p-value needed to exclude false positives is reduced.  Instead of 
calculating these probabilities explicitly, we will simply consider any result 
with p \textless 0.05 as possibly significant and any with p \textless 
0.0022 as definitely significant.  

Our results are presented in Table \ref{tbl:mannwhitneyu}.  We find that the 
environmental $\theta_l$ and $\theta_\rho$ encountered by the clouds between 
550-750 m are not significantly different for tall clouds than for short 
clouds.  Environmental $q_t$ is on the borderline for statistical significance, 
with moister environments tending to encourage taller clouds.  However, the 
effect of environmental humidity pales in comparison with the vertical velocity 
of the cloud environment, which is on average 0.05 m s$^{-1}$ larger between 
550-750 m for the tall clouds than the short clouds.  Thermodynamic cloud top 
properties are likewise not significantly different between tall and short 
clouds.  Cloud top vertical velocity is possibly significant, with 
faster-rising clouds slightly more likely to become tall, but much more 
important is the cloud cross-sectional area $a$ and mass flux $M$, with 
extremely small p-values of 2.6x10$^{-11}$ and 5.8x10$^{-11}$, respectively; 
clouds with larger cross-sectional areas and greater vertical mass flux are 
more likely to become tall clouds.

However, simply because the differences in these values are statistically 
significant does not mean that they are important.  Examining histograms of 
environmental $q_t$ and $w$ and cloud top $w$ and $a$ (Figure 
\ref{fig:cloud_environment_histograms}) shows that, while the differences 
between the tall and short clouds are unlikely to have occurred by chance, 
clouds tops with small areas, in environments moving upward slowly, still have 
a reasonable chance of becoming tall clouds.  These properties certainly have 
an influence on the cloud height, but it is clearly not a definitive one.

As the clouds rise above cloud base, the properties associated with short and 
tall clouds change (Table \ref{tbl:mannwhitneyu}).  The average environmental 
values of $q_t$, $\theta_l$, and $\theta_\rho$ encountered by the clouds 
between 750-1000 m are not significantly different for short clouds than for 
tall clouds.  The vertical velocity of the environment in this height range 
still has an effect, but it is slightly less significant than it is closer to 
cloud base, although the size of the difference is about the same 
(0.05 m s$^{-1}$).  However, all tested cloud top variables show significant 
differences between the short and tall clouds.  Clouds with large $q_t$, $q_l$, 
$\theta_\rho$, $w$, $a$, and $M$, and lower $\theta_l$, between 750-1000 m, 
are more likely to rise past 1300 m.  Of these properties, cloud top area and 
mass flux are again the most significant differences.

\subsection{Discussion}

Our results present the following picture of the dynamics of the BOMEX cloud 
field.  The sub-cloud layer is well mixed and filled with broad regions of 
upward, and equally large regions of downward, motion (Figure 
\ref{fig:vertical_section}).  These regions are large enough that they are 
relatively shielded from mixing with other air masses and property anomalies 
easily propagate vertically.  Conversely, the upward velocity of air parcels in 
this region are controlled by turbulent inertia and pressure effects (but not 
buoyancy), and anomalies quickly dissipate.

Once the broad regions of rising air reach cloud base, a different set of 
physics takes over.  As rising parcels reach the top of the sub-cloud layer, 
they lose buoyancy, and must rely on inertia and pressure perturbations to 
allow them to continue rising.  Thus, the environmental stability at cloud base 
acts as a filter which admits only the fastest moving parcels, or the parcels 
in a region of organized motion with a pressure perturbation sufficient to 
overcome the negative buoyancy (i.e., a cloud with a large horizontal area).  
Hence, larger area clouds in an upward moving environment are better able to
penetrate through cloud base.

However, once above the cloud base region, yet another set of physics comes 
into play.  The fate of these clouds is a race between the rate the cloud moves 
upward and the rate the cloud is mixed away into the environment.  As the 
clouds rise, latent heating from condensation enhances their buoyancy and 
creates a feedback loop in which faster moving clouds gain more buoyancy, and 
more buoyant clouds move faster.  At the same time, entrainment and mixing 
tend to wipe out this excess buoyancy.  Clouds with higher moisture content and 
buoyancy are more likely to remain buoyant, so thermodynamic quantities become 
important in determining eventual cloud height.  However, cloud area dominates 
these effects, as larger clouds are better able to shield their cores from 
mixing with the environment.  This set of physics persists until the clouds 
reach the inversion, where the latent heating rate is incapable of keeping the 
clouds buoyant in the face of the strong $\theta$ gradient, and they are mixed 
away.

Using numerical tracers in a BOMEX LES, \cite{Romps2010a} found that 
stochastic entrainment controlled the evolution of convecting parcels, not 
the thermodynamic properties of those parcels at cloud base.  Our results 
extend this conclusion to apply to whole clouds.  However, our results also 
show that cloud base area exerts strong controls over the upper-level area and 
maximum height of the cloud.  Because of this we conclude that both nature, in 
the form of cloud base area, and nurture, in the form of entrainment and 
detrainment, have roles in the dynamics of BOMEX shallow cumulus clouds.  

Finally, the strong effect we find that cloud area has on the eventual cloud 
top height cloud suggests a simple physical interpretation for the stochastic 
entrainment event parametrization proposed by \cite{Romps2010a}: entrainment 
events occur when a parcel reaches the edge of the cloud. This idea is 
supported by examining the changes in the probability distribution of $q_t$ 
values at various distances from the cloud surface (Figure 
\ref{fig:qt_vs_dist}): cloud parcels far from the cloud surface display higher
mean humidities than parcels near the cloud surface, indicating that interior 
parcels are shielded from mixing with the environment.  This hypothesis 
implies that the probability of a parcel experiencing an entrainment event 
should be related to the ratio of the total cloud area to the area of the 
cloud within some mixing length of the cloud edge.

%==============================================================================

\conclusions
%% \conclusions[modified heading if necessary]
We have developed an algorithm for tracking individual shallow cumulus clouds 
in a LES simulation which generates reasonable statistical distributions for a 
variety of cloud properties.  The key innovations this algorithm employs are 
the use of non-buoyant cloud parcels as a buffer region to mediate merging and 
splitting of buoyant cloud plumes, and a numerical tracer which we use to 
evaluate if a cloud plume remains dynamically connected to the planetary 
surface.  The output of this algorithm is suitable for conducting statistical 
analyses of shallow cumulus cloud populations.  We believe this algorithm could 
be easily extended to study deep convection.  We include in the supplementary 
material of this paper our implementation of this algorithm, written in Python, 
for general use by the cloud modeling community.

BOMEX cloud properties above cloud base divide into three groups of variables 
that are highly correlated: the thermodynamic properties $q_t$, $\theta_l$, 
and $\theta_\rho$; the vertical velocity $w$; and the area $a$ and vertical 
mass flux $M$.  The thermodynamic properties show little variation at cloud 
base, but their variability increases steadily with height; cloud area is 
quite variable at cloud base and maintains its variance with height; and 
vertical velocity falls between these two extremes.

Analyzing the upward propagation of property anomalies shows three sets of 
physics operating on the clouds at different heights.  Below cloud base, cloud 
plumes are large and homogenous and upward motion is primarily governed by 
turbulence.  The buoyancy of plumes rapidly decreases at cloud base, which 
prevents all but the fastest rising plumes from penetrating into the cloud 
layer.  If these plumes make it through the cloud base layer, dilution by the 
environment competes with buoyancy production from latent heating to control 
the ascent of the clouds to the inversion.  These results suggest that 
nature controls the area and eventual height reached by the clouds, while 
nurture controls their thermodynamic properties.

%\appendix
%\section{\\ \\ \hspace*{-7mm} HEADING}    %% Appendix A

%\subsection                               %% Appendix A1, A2, etc.

\begin{acknowledgements}
Support for this research was provided by the Canadian Foundation for Climate 
and Atmospheric Science through the Cloud Aerosol Feedback and Climate 
network. We thank Marat Khairoutdinov for making SAM available to the cloud 
modeling community. Figures were generated using the matplotlib library in the 
Python programming language.
\end{acknowledgements}


\bibliographystyle{copernicus}
\bibliography{./bibliography/cloud_tracking}


%% Literature citations
%% command                        & example result
%% \citet{jones90}|               & Jones et al.\ (1990)
%% \citep{jones90}|               & (Jones et al., 1990)
%% \citep{jones90,jones93}|       & (Jones et al., 1990, 1993)
%% \citep[p.~32]{jones90}|        & (Jones et al., 1990, p.~32)
%% \citep[e.g.,][]{jones90}|      & (e.g., Jones et al., 1990)
%% \citep[e.g.,][p.~32]{jones90}| & (e.g., Jones et al., 1990, p.~32)
%% \citeauthor{jones90}|          & Jones et al.
%% \citeyear{jones90}|            & 1990






%% FIGURES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% ONE-COLUMN FIGURES

%f
%\begin{figure}[t]
%\vspace*{2mm}
%\begin{center}
%\includegraphics[width=8.3cm]{./figures/figure1}
%\end{center}
%\caption{Schematic representation of our cloudlet algorithm.}
%\label{fig:cloudfinder_instructions}
%\end{figure}


%% TWO-COLUMN FIGURES

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/vertical_section}
\end{center}
\caption{Vertical section through the BOMEX model, showing the cloud core
(red), the cloud (yellow) and the plume (blue) regions used by the cloud 
tracking algorithm. Black lines show the edges of ``cloudlets" identified by 
the cloud tracking algorithm.}
\label{fig:vertical_section}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloudfinder_instructions}
\end{center}
\caption{Schematic representation of our cloud tracking algorithm.}
\label{fig:cloudfinder_instructions}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/example_cloud}
\end{center}
\caption{Height-time profiles of cloud properties of the longest-lived cloud 
in the BOMEX simulation.}
\label{fig:example_cloud}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/example_core}
\end{center}
\caption{Height-time profiles of core properties of the longest-lived cloud in 
the BOMEX simulation.}
\label{fig:example_core}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_stats}
\end{center}
\caption{Histograms of cloud lifetimes and heights.}
\label{fig:cloud_stats}
\end{figure*}

%f
\begin{figure}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=8.3cm]{./figures/cloud_areas}
\end{center}
\caption{Cloud size density}
\label{fig:cloud_areas}
\end{figure}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_autocorrelation}
\end{center}
\caption{Height profiles of cloud property cross-correlations.}
\label{fig:cloud_autocorrelation}
\end{figure*}

%f
\begin{figure}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=8.3cm]{./figures/st_dev}
\end{center}
\caption{Normalized standard deviations}
\label{fig:st_dev}
\end{figure}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_base_schematic}
\end{center}
\caption{Schematic of cloud base correlation calculation.}
\label{fig:cloud_base_schematic}
\end{figure*}

%f
\begin{figure}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=8.3cm]{./figures/sub_cloud_profiles}
\end{center}
\caption{Correlation profiles between sub-cloud properties and various cloud heights.}
\label{fig:sub_cloud_profiles}
\end{figure}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_base_profiles}
\end{center}
\caption{Correlation profiles between cloud base and various cloud heights.}
\label{fig:cloud_base_profiles}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_base_integrals_env}
\end{center}
\caption{Correlation profiles between integrated entrainment/detrainment 
properties and various cloud heights.}
\label{fig:cloud_base_integrals_env}
\end{figure*}

%f
%\begin{figure*}[t]
%\vspace*{2mm}
%\begin{center}
%\includegraphics[width=\textwidth]{./figures/900m_profiles}
%\end{center}
%\caption{Correlation profiles between 900m properties and various cloud heights.}
%\label{fig:900m_profiles}
%\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_environment_schematic}
\end{center}
\caption{Schematic of encountered cloud environment calculation.}
\label{fig:cloud_environment_schematic}
\end{figure*}

%f
\begin{figure*}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=\textwidth]{./figures/cloud_environment_histograms}
\end{center}
\caption{Histograms of encountered cloud environment.}
\label{fig:cloud_environment_histograms}
\end{figure*}

%f
\begin{figure}[t]
\vspace*{2mm}
\begin{center}
\includegraphics[width=8.3cm]{./figures/qt_vs_dist}
\end{center}
\caption{Total humidity vs distance from nearest cloud surface}
\label{fig:qt_vs_dist}
\end{figure}

%% TABLES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% ONE-COLUMN TABLE

%t
%\begin{table}[t]
%\label{tbl:cloud_stats}
%\caption{Statistics of tracked clouds}
%\vskip4mm
%\centering
%\begin{tabular}{llcr}
%\tophline
%&&BOMEX\\
%\middlehline
%Total Clouds&&1480\\
%Starts\\
%&Broken&64\\
%&Split&539\\
%&New&877\\
%Ends\\
%&Broken&56\\
%&Merge&91\\
%&Decay&1333\\

%\bottomhline
%\end{tabular}
%\end{table}

%t
%\begin{table}[t]
%\caption{t-test Results}
%\vskip4mm
%\centering
%\begin{tabular}{lcccc}
%\tophline
%&Variable&t-test value&Significance&Direction\\
%\middlehline
%environment&&&\\
%& $q_t$ & -1.33 & 81\% & n/a\\
%& $q_n$ & 0.02 & 2\% & n/a\\
%& tracer & 0.72 & 53\% & n/a\\
%& $\theta_l$ & 2.53 & 98\% & $\downarrow$\\
%& $\theta_v$ & 2.77 & 99.4\% & $\downarrow$\\
%& $w$ & -4.99 & 99.9999\% & $\uparrow$\\
%core&&&\\
%& $q_t$ & 1.57 & 88\% & n/a \\
%& $q_n$ & -0.04 &  3\% & n/a \\
%& $\theta_l$ & -2.10 & 96\% & $\uparrow$ \\
%& $\theta_v$ & -3.55 & 99.96\% & $\uparrow$ \\
% $w$ & -4.21 & 99.997\% & $\uparrow$ \\
%& $\chi_c$ & -5.14 & 99.99995\% & $\uparrow$ \\
%& $a$ & -7.10 & 99.999999992\% & $\uparrow$ \\

%\bottomhline
%\end{tabular}
%\end{table}

%% TWO-COLUMN TABLE

t
\begin{table*}[t]
\label{tbl:mannwhitneyu}
\caption{t-test results}
\vskip4mm
\centering
\begin{tabular}{lccccclr}
\tophline
& Variable & N tall & N small & $\Delta$ mean & $\Delta$ mean/st. dev. & U value & p value\\
\middlehline
environment 550-750 m & & 131 & 136 & & & & \\
& $q_t$       & & &  0.03 g kg$^{-1}$          &  0.24 & 6,803   & 0.015    \\ 
& $\theta_l$ & & & -0.008 K                   & -0.19 & 7,173.5 & 0.07    \\
& $\theta_\rho$ & & & -0.002 K               & -0.09 & 7,767   & 0.42    \\
& $w$         & & &  0.05 m s$^{-1}$           &  0.45 & 6,113   & 3.3x10$^{-4}$ \\
cloud 550-750 m & & & & & & \\
& $q_t$       & & &  0.018 g kg$^{-1}$         &  0.19 & 7,358   & 0.13   \\
& $q_l$       & & &  4.9x10$^{-3}$ g kg$^{-1}$ &  0.16 & 7,533   & 0.23   \\
& $\theta_l$ & & & -8.6x10$^{-5}$ K           & -0.004 & 8,083.5 & 0.78 \\
& $\theta_\rho$ & & &  0.013 K               &  0.20 & 7,350   & 0.13  \\
& $w$         & & &  0.05 m s$^{-1}$           &  0.28 & 6,911   & 0.024  \\
& $a$         & & &  2,138 m$^2$                &  0.78 & 4,282.5 & 2.6x10$^{-11}$ \\
& $M$         & & &  2,440 kg s$^{-1}$    &  0.77 & 4,351 & 5.8x10$^{-11}$ \\
environment 750-1000 m & & 127 & 113 & & & & \\
& $q_t$       & & &  0.03 g kg$^{-1}$          &  0.14 & 6,574 & 0.26    \\
& $\theta_l$ & & & -0.007 K                   & -0.12 & 6,533 & 0.23    \\
& $\theta_\rho$ & & & -0.003 K               & -0.08 & 6,888 & 0.59    \\
& $w$         & & &  0.05 m s$^{-1}$           &  0.45 & 5,145 & 1.6x10$^{-4}$ \\
cloud 750-1000 m & & & & & &          \\
& $q_t$       & & &  0.1 g kg$^{-1}$           &  0.70 & 4,368   & 1.7x10$^{-7}$ \\
& $q_l$       & & &  0.04 g kg$^{-1}$          &  0.66 & 4,468   & 4.6x10$^{-7}$ \\
& $\theta_l$ & & & -0.03 K                    & -0.51 & 4,974   & 4.1x10$^{-5}$  \\
& $\theta_\rho$ & & &  0.07 K                &  0.71 & 4,290   & 7.7x10$^{-8}$ \\
& $w$         & & &  0.11 m s$^{-1}$           &  0.46 & 5,225   & 2.8x10$^{-4}$  \\
& $a$         & & &  2,661 m$^2$                &  0.89 & 3,333.5 & 8.3x10$^{-13}$ \\
& $M$         & & &  4,711 kg s$^{-1}$    &  0.92 & 2,938 & 2.9x10$^{-15}$ \\

\bottomhline
\end{tabular}
\end{table*}

%% The different columns must be seperated with a & command and should
%% end with \\ to identify the column brake.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% If figures and tables must be numbered 1a, 1b, etc. the following command
%% should be inserted before the begin{} command.

%\addtocounter{figure}{-1}\renewcommand{\thefigure}{\arabic{figure}a}


\end{document}
